<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js rust">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Geo Faker</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="geo-faker.html"><strong aria-hidden="true">1.</strong> What is Geo Faker?</a></li><li class="chapter-item expanded "><a href="quick-start.html"><strong aria-hidden="true">2.</strong> Quick Start</a></li><li class="chapter-item expanded "><a href="customize.html"><strong aria-hidden="true">3.</strong> Customize</a></li><li class="chapter-item expanded "><a href="docker-image.html"><strong aria-hidden="true">4.</strong> Docker image</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Geo Faker</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rustprooflabs/geofaker" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="what-is-geo-faker"><a class="header" href="#what-is-geo-faker">What is Geo Faker?</a></h1>
<p>Geo Faker is a project to create fake geospatial data in PostGIS.
The generated data is based on real OpenStreetMap region, using
the region of your choice.  The whole process is easy
thanks to the <a href="https://pgosm-flex.com/">PgOSM Flex</a>
project, which provides the main functionality used by Geo Faker.</p>
<p>The Geo Faker project currently creates two tables with fake store
and fake customer data, in tables <code>geofaker.store</code> and <code>geofaker.customer</code>
respectively.  The use of OpenStreetMap data
as a starting point provides a sense of realism. The use of <code>random()</code>
and other methods to generate fake data avoid privacy concerns.</p>
<blockquote>
<p>Warning: This project is in early development!  Things will be changing quickly over the first few releases (e.g. before 0.5.0).</p>
</blockquote>
<h2 id="faked-data"><a class="header" href="#faked-data">Faked Data</a></h2>
<p>The following images show Geo Faker at work using the data from
the entire United States as its input.  This first image shows
the store placements around the lower-48 states of the United States.
Store data is saved to the table <code>geofaker.store</code>.</p>
<p><img src="geo-faker-0-1-1-stores-us.jpg" alt="Map of United States (lower 48) with the title &quot;Geo Faker Stores - United States&quot;.  Purple dots representing fake stores are indicated across the entire country.  Copyright OpenStreetMap Contributors" /></p>
<h2 id="stores"><a class="header" href="#stores">Stores</a></h2>
<pre><code class="language-sql">SELECT *
    FROM geofaker.store
    WHERE id = 1
;
</code></pre>
<pre><code>┌─[ RECORD 1 ]┬───────────────────────────────┐
│ store_id    │ 1                             │
│ city        │ Friendship Heights            │
│ street_name │ 42nd Street Northwest         │
│ ref         │ ¤                             │
│ company     │ Wolff, Bauch, and Stokes      │
│ slogan      │ Intuitive non-volatile niches │
│ phone       │ (866) 487-9434                │
└─────────────┴───────────────────────────────┘
</code></pre>
<h2 id="customers"><a class="header" href="#customers">Customers</a></h2>
<pre><code class="language-sql">SELECT *
    FROM geofaker.customer
    WHERE id = 1
;
</code></pre>
<pre><code>┌─[ RECORD 1 ]┬──────────────────────────────┐
│ id          │ 1                            │
│ store_id    │ 1                            │
│ customer_id │ 48                           │
│ full_name   │ Gunnar Fahey Sr.             │
│ email       │ louveniahettinger@hamill.biz │
│ phone       │ (588) 985-5244               │
└─────────────┴──────────────────────────────┘
</code></pre>
<h2 id="more-images"><a class="header" href="#more-images">More images</a></h2>
<p>The next image is zoomed in to show the faked store and customer
data in Wisconsin, with Madison, WI in the center of the image and
Milwaukee, WI on the right side. This image shows the current distribution
and range of the faked customer data is not ideal.  It is currently
hard coded to a (inexact) 5 kilometer (km) radius.
<a href="https://github.com/rustprooflabs/geofaker/issues/6">Issue #6</a>
was opened to address that limitation.</p>
<p><img src="geo-faker-0-1-1-stores-customers-wi.jpg" alt="Map of Wisconsin in the U.S. with the title &quot;Geo Faker Customers and Stores - Wisconsin&quot;.  Purple dots represent fake stores, light brown/gray dots represent fake customers.  Fake customers are placed within roughly 5 kilometers of their associated store. Copyright OpenStreetMap Contributors" /></p>
<p>The next map is zoomed in to one store in Madison, WI with only that
store's customers selected.</p>
<p><img src="geo-faker-0-1-1-storescustomers-madsion-wi.jpg" alt="Map of Wisconsin in the U.S. with the title &quot;Geo Faker - One Store with Customers - Madison, Wisconsin&quot;.  One purple dots representing a single fake store surrounded by brown dots representing fake customers.  Fake customers are placed within roughly 5 kilometers of their associated store. Copyright OpenStreetMap Contributors" /></p>
<p>An even closer view at the street level shows that all of the points
are placed directly on roads.  The main reason for this was to force
truly random points into a more realistic set of locations.</p>
<p>One benefit from this decision is this makes Geo Faker data
easy to use for routing with <code>pgrouting</code>.</p>
<p><img src="geo-faker-0-1-1-storescustomers-street-level.jpg" alt="alt coming soon" /></p>
<h2 id="size-of-data"><a class="header" href="#size-of-data">Size of data</a></h2>
<p>The exact row counts will vary from run to run, even with the same inputs.
The details shown below illustrate roughly what is generated with the
entire U.S. as the input.</p>
<pre><code class="language-sql">SELECT s_name, table_count, view_count, function_count,
        size_plus_indexes
    FROM dd.schemas WHERE s_name IN ('geofaker', 'osm')
;
</code></pre>
<pre><code>┌──────────┬─────────────┬────────────┬────────────────┬───────────────────┐
│  s_name  │ table_count │ view_count │ function_count │ size_plus_indexes │
╞══════════╪═════════════╪════════════╪════════════════╪═══════════════════╡
│ geofaker │           2 │          0 │              3 │ 277 MB            │
│ osm      │          10 │          1 │              4 │ 18 GB             │
└──────────┴─────────────┴────────────┴────────────────┴───────────────────┘
</code></pre>
<pre><code class="language-sql">SELECT s_name, t_name, rows, size_plus_indexes, description
    FROM dd.tables
    WHERE s_name IN ('geofaker')
;
</code></pre>
<pre><code>┌──────────┬──────────┬─────────┬───────────────────┬───────────────────────────────────────────────────┐
│  s_name  │  t_name  │  rows   │ size_plus_indexes │                    description                    │
╞══════════╪══════════╪═════════╪═══════════════════╪═══════════════════════════════════════════════════╡
│ geofaker │ store    │    4331 │ 656 kB            │ Created by Geo Faker, a PgOSM Flex based project. │
│ geofaker │ customer │ 3424117 │ 276 MB            │ Created by Geo Faker, a PgOSM Flex based project. │
└──────────┴──────────┴─────────┴───────────────────┴───────────────────────────────────────────────────┘
</code></pre>
<p>Checking what was loaded in the <code>osm.pgosm_flex</code> table.</p>
<pre><code class="language-sql">SELECT osm_date, region, layerset, pgosm_flex_version
    FROM osm.pgosm_flex
;
</code></pre>
<pre><code>┌────────────┬──────────────────┬──────────┬────────────────────┐
│  osm_date  │      region      │ layerset │ pgosm_flex_version │
╞════════════╪══════════════════╪══════════╪════════════════════╡
│ 2023-04-30 │ north-america-us │ faker    │ 0.8.0-8fb2621      │
└────────────┴──────────────────┴──────────┴────────────────────┘
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="quick-start-to-geo-faker"><a class="header" href="#quick-start-to-geo-faker">Quick Start to Geo Faker</a></h1>
<p>This section covers how to get started with the Faker version of PgOSM Flex,
also known as Geo Faker.</p>
<blockquote>
<p>Warning: This project is in early development!  Things will be changing over the first few releases (e.g. before 0.5.0).</p>
</blockquote>
<p>The basic process to using Geo Faker are:</p>
<ul>
<li>Run PgOSM Flex with custom layerset</li>
<li>Load Geo Faker objects</li>
<li>Run stored procedures</li>
<li>Move temp table data to real tables</li>
</ul>
<h2 id="load-openstreetmap-data"><a class="header" href="#load-openstreetmap-data">Load OpenStreetMap Data</a></h2>
<p>Load the region/subregion you want using the PgOSM Flex Docker image.
These instructions are modified from
<a href="https://pgosm-flex.com/quick-start.html">PgOSM Flex's Quick Start</a>
section. The following loads the data into a PostGIS enabled database in a <code>geofaker</code>
Docker container available on port 5433.</p>
<pre><code class="language-bash">mkdir ~/pgosm-data
export POSTGRES_USER=postgres
export POSTGRES_PASSWORD=mysecretpassword

docker pull rustprooflabs/geofaker:latest

docker run --name geofaker -d --rm \
    -v ~/pgosm-data:/app/output \
    -v /etc/localtime:/etc/localtime:ro \
    -e POSTGRES_USER=$POSTGRES_USER \
    -e POSTGRES_PASSWORD=$POSTGRES_PASSWORD \
    -p 5439:5432 -d rustprooflabs/geofaker

docker exec -it \
    geofaker python3 docker/pgosm_flex.py \
    --ram=8 \
    --region=north-america/us \
    --subregion=district-of-columbia \
    --layerset=faker
</code></pre>
<h2 id="load-and-run-faker-objects"><a class="header" href="#load-and-run-faker-objects">Load and Run Faker Objects</a></h2>
<p>After the data completes processing, load the Geo Faker database structures
in the <code>geofaker</code> schema.  This deploys the functions and procedures needed,
runs the processing, and runs <code>pg_dump</code> saving the faked
data into <code>~/pgosm-data/geofaker_stores_customers.sql</code>.</p>
<pre><code class="language-bash">docker exec -it geofaker /bin/bash run_faker.sh
</code></pre>
<p>Load the saved data into a database of your choice.</p>
<pre><code class="language-bash">psql -d pgosm_faker -f ~/pgosm-data/geofaker_stores_customers.sql 
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="customize"><a class="header" href="#customize">Customize</a></h1>
<p>This section builds on the <a href="quick-start.html">Quick Start</a> section.
Customizing the runtime operation of Geo Faker currently involves
manually connecting to the Geo Faker database and changing things.
In the near (ish?) future customization should become easier,
see <a href="https://github.com/rustprooflabs/geofaker/issues/9">issue #9</a>.</p>
<blockquote>
<p>Warning: This project is in early development!  Things will be changing over the first few releases (e.g. before 0.5.0).</p>
</blockquote>
<h2 id="range-and-density-of-customer-points"><a class="header" href="#range-and-density-of-customer-points">Range and Density of Customer points</a></h2>
<p>The customer points currently have two main tunable options:</p>
<ul>
<li><code>_distance_scale</code> default 1.5</li>
<li><code>_density_scale</code> default 1.0</li>
</ul>
<p>After running the main process, you can re-run the steps creating the <code>geofaker.customer</code>
points using the following code.  This example doubles the density scale (from 1.5 to 3)
and reduces density from 1.0 to 0.25.</p>
<blockquote>
<p>See <code>app/run_faker.sql</code> for what runs by default.</p>
</blockquote>
<pre><code class="language-sql">CALL geofaker.points_around_point(_distance_scale:=3,
                                  _density_scale:=0.25);

DROP TABLE IF EXISTS geofaker.customer;
CREATE TABLE geofaker.customer AS
SELECT *
    FROM faker_customer_location
    ORDER BY store_id, customer_id
;
COMMENT ON TABLE geofaker.customer IS 'Created by Geo Faker, a PgOSM Flex based project.';
</code></pre>
<h2 id="custom-places-for-shops"><a class="header" href="#custom-places-for-shops">Custom Places for Shops</a></h2>
<p>The procedure <code>geo_faker.point_in_place_landuse()</code> allows overriding
the inclusion of <code>retail</code> and <code>commercial</code> landuse.
This is done by creating a custom <code>landuse_osm_types</code> table before
running the stored procedure.</p>
<pre><code class="language-sql">DROP TABLE IF EXISTS landuse_osm_types;
CREATE TEMP TABLE IF NOT EXISTS landuse_osm_types AS
SELECT 'college' AS osm_type
UNION
SELECT 'recreation_ground' AS osm_type
UNION
SELECT 'vineyard' AS osm_type
;
</code></pre>
<h2 id="external-postgres-connections"><a class="header" href="#external-postgres-connections">External Postgres connections</a></h2>
<p>Geo Faker can load data into an external database, though the steps are currently
more manual than then in-Docker. Start by setting
<a href="https://pgosm-flex.com/postgres-permissions.html">Postgres permissions</a> in the
target database.  Then setup an environment variable and run the Docker container
with the additional parameters <a href="https://pgosm-flex.com/postgres-external.html">shown here</a>.</p>
<p>Run the initial PgOSM Flex part of the process to load the OpenStreetMap data.</p>
<pre><code class="language-bash">source ~/.pgosm-faker-local

docker run --name geofaker -d --rm \
    -v ~/pgosm-data:/app/output \
    -v /etc/localtime:/etc/localtime:ro \
    -e POSTGRES_USER=$POSTGRES_USER \
    -e POSTGRES_PASSWORD=$POSTGRES_PASSWORD \
    -e POSTGRES_HOST=$POSTGRES_HOST \
    -e POSTGRES_DB=$POSTGRES_DB \
    -e POSTGRES_PORT=$POSTGRES_PORT \
    -p 5439:5432 -d rustprooflabs/geofaker

docker exec -it \
    geofaker python3 docker/pgosm_flex.py \
    --ram=8 \
    --region=north-america/us \
    --subregion=colorado \
    --layerset=faker
</code></pre>
<p>From the <code>geofaker</code> directory, change into the <code>db</code> folder to deploy the Sqitch
schema needed for Geo Faker.</p>
<pre><code class="language-bash">cd ~/git/geofaker/db
sqitch db:pg://$POSTGRES_USER:$POSTGRES_PASSWORD@$POSTGRES_HOST:$POSTGRES_PORT/$POSTGRES_DB deploy
</code></pre>
<p>You can run the SQL steps exactly from the script.  Or customize them first.</p>
<pre><code class="language-bash">psql -d postgres://$POSTGRES_USER:$POSTGRES_PASSWORD@$POSTGRES_HOST:$POSTGRES_PORT/$POSTGRES_DB \
    -f ~/git/geofaker/run_faker.sql
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="docker-image"><a class="header" href="#docker-image">Docker image</a></h1>
<blockquote>
<p>Warning: This project is in early development!  Things will be changing over the first few releases (e.g. before 0.5.0).</p>
</blockquote>
<h2 id="building-the-image"><a class="header" href="#building-the-image">Building the image</a></h2>
<p>Build latest.  Occasionally run with <code>--no-cache</code> to force some software updates.</p>
<pre><code class="language-bash">docker pull rustprooflabs/pgosm-flex:latest
docker build -t rustprooflabs/geofaker:latest .
</code></pre>
<pre><code class="language-bash">docker push rustprooflabs/geofaker:latest
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
